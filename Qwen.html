<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Shop Calculator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background-color: #0d0f12;
      color: white;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .header {
      padding: 16px;
      text-align: center;
      font-size: 18px;
      font-weight: 500;
    }

    .display {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      padding: 24px 20px 16px;
      background-color: #0d0f12;
    }

    .current-value {
      font-size: 36px;
      font-weight: 300;
      text-align: right;
      min-height: 48px;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }

    .previous-value {
      font-size: 20px;
      color: rgba(255, 255, 255, 0.7);
      text-align: right;
      margin-top: 8px;
      min-height: 24px;
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      padding: 16px;
      background-color: #0d0f12;
    }

    .btn {
      aspect-ratio: 1;
      border-radius: 50%;
      border: none;
      font-size: 24px;
      font-weight: 500;
      outline: none;
      cursor: pointer;
      user-select: none;
      transition: transform 0.2s, opacity 0.2s;
    }

    .btn:active {
      transform: scale(0.92);
      opacity: 0.8;
    }

    .btn-ac {
      background-color: #005f6b;
      color: white;
    }

    .btn-op, .btn-eq {
      background-color: #3a4b52;
      color: white;
    }

    .btn-eq {
      background-color: #c3cae2;
      color: #0d0f12;
    }

    .btn-num {
      background-color: #2d3035;
      color: white;
    }

    .btn-zero {
      grid-column: span 2;
    }

    .btn-dot {
      background-color: #2d3035;
      color: white;
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-content {
      background-color: #1e2126;
      border-radius: 20px;
      width: 90%;
      max-width: 360px;
      padding: 24px;
      text-align: center;
    }

    .modal h2 {
      font-size: 22px;
      margin-bottom: 20px;
      color: white;
    }

    .modal input {
      width: 100%;
      padding: 16px 16px;
      font-size: 18px;
      border-radius: 12px;
      border: none;
      background-color: #2d3035;
      color: white;
      margin-bottom: 20px;
      text-align: center;
    }

    .modal-btn {
      width: 100%;
      padding: 16px;
      font-size: 18px;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      background-color: #005f6b;
      color: white;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .modal-btn:active {
      background-color: #004a54;
    }

    .footer-note {
      text-align: center;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
      padding: 12px;
    }
  </style>
</head>
<body>
  <div class="header">Shop Calculator</div>

  <div class="display">
    <div class="previous-value" id="prevOp"></div>
    <div class="current-value" id="currentValue">0</div>
  </div>

  <div class="buttons">
    <button class="btn btn-ac" data-action="clear">AC</button>
    <button class="btn btn-op" data-action="parentheses">()</button>
    <button class="btn btn-op" data-action="percent">%</button>
    <button class="btn btn-op" data-action="divide">Ã·</button>

    <button class="btn btn-num" data-number="7">7</button>
    <button class="btn btn-num" data-number="8">8</button>
    <button class="btn btn-num" data-number="9">9</button>
    <button class="btn btn-op" data-action="multiply">Ã—</button>

    <button class="btn btn-num" data-number="4">4</button>
    <button class="btn btn-num" data-number="5">5</button>
    <button class="btn btn-num" data-number="6">6</button>
    <button class="btn btn-op" data-action="subtract">âˆ’</button>

    <button class="btn btn-num" data-number="1">1</button>
    <button class="btn btn-num" data-number="2">2</button>
    <button class="btn btn-num" data-number="3">3</button>
    <button class="btn btn-op" data-action="add">+</button>

    <button class="btn btn-zero" data-number="0">0</button>
    <button class="btn btn-dot" data-number=".">.</button>
    <button class="btn btn-op" data-action="backspace">âŒ«</button>
    <button class="btn btn-eq" data-action="equals">=</button>
  </div>

  <div class="footer-note">Tap "Send Invoice" to share via WhatsApp</div>

  <!-- Send Invoice Modal -->
  <div class="modal" id="invoiceModal">
    <div class="modal-content">
      <h2>Send Invoice</h2>
      <input type="tel" id="phoneNumber" placeholder="Enter phone number (e.g. 9876543210)" maxlength="15" />
      <button class="modal-btn" id="sendBtn">Send via WhatsApp</button>
    </div>
  </div>

  <script>
    // State
    let currentValue = '0';
    let previousValue = '';
    let operator = null;
    let waitingForSecondOperand = false;
    let calculationHistory = []; // e.g., ['250', '+', '400', '+', '50']

    const currentValueEl = document.getElementById('currentValue');
    const prevOpEl = document.getElementById('prevOp');
    const invoiceModal = document.getElementById('invoiceModal');
    const phoneNumberInput = document.getElementById('phoneNumber');
    const sendBtn = document.getElementById('sendBtn');

    // Update display
    function updateDisplay() {
      currentValueEl.textContent = currentValue;
      prevOpEl.textContent = previousValue;
    }

    // Format number with commas (optional, but clean)
    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    // Clear everything
    function clearAll() {
      currentValue = '0';
      previousValue = '';
      operator = null;
      waitingForSecondOperand = false;
      calculationHistory = [];
      updateDisplay();
    }

    // Input number
    function inputNumber(num) {
      if (waitingForSecondOperand) {
        currentValue = String(num);
        waitingForSecondOperand = false;
        return;
      }

      currentValue = currentValue === '0' ? String(num) : currentValue + num;
      updateDisplay();
    }

    // Input decimal
    function inputDecimal() {
      if (waitingForSecondOperand) {
        currentValue = '0.';
        waitingForSecondOperand = false;
        updateDisplay();
        return;
      }

      if (!currentValue.includes('.')) {
        currentValue += '.';
        updateDisplay();
      }
    }

    // Handle operator (+, -, Ã—, Ã·)
    function handleOperator(nextOperator) {
      const current = parseFloat(currentValue);

      if (previousValue === '') {
        previousValue = `${current} ${nextOperator}`;
        calculationHistory.push(String(current), nextOperator);
      } else if (operator && !waitingForSecondOperand) {
        const prev = parseFloat(currentValue);
        const result = calculate(parseFloat(prevOpEl.textContent.split(' ')[0]), prev, operator);
        currentValue = String(result);
        previousValue = `${result} ${nextOperator}`;
        calculationHistory = [String(result), nextOperator];
      } else {
        previousValue = `${currentValue} ${nextOperator}`;
        calculationHistory.push(String(currentValue), nextOperator);
      }

      waitingForSecondOperand = true;
      operator = nextOperator;
      updateDisplay();
    }

    // Calculate
    function calculate(firstValue, secondValue, op) {
      switch (op) {
        case '+': return firstValue + secondValue;
        case '-': return firstValue - secondValue;
        case 'Ã—': return firstValue * secondValue;
        case 'Ã·': return secondValue !== 0 ? firstValue / secondValue : 0;
        default: return secondValue;
      }
    }

    // Equals
    function handleEquals() {
      if (operator === null || previousValue === '') return;

      const firstValue = parseFloat(prevOpEl.textContent.split(' ')[0]);
      const secondValue = parseFloat(currentValue);
      const result = calculate(firstValue, secondValue, operator);

      // Build summary for WhatsApp
      let summaryLines = [];
      let totalLine = '';

      // Reconstruct expression from history
      let expr = '';
      for (let i = 0; i < calculationHistory.length; i++) {
        const item = calculationHistory[i];
        if (i === 0) {
          expr = item;
        } else if (item === '+' || item === '-' || item === 'Ã—' || item === 'Ã·') {
          expr += ` ${item} `;
        } else {
          expr += item;
        }
      }

      // Parse history into lines: each number + operator (except last)
      let tempHistory = [...calculationHistory];
      if (tempHistory.length > 0 && !['+', '-', 'Ã—', 'Ã·'].includes(tempHistory[tempHistory.length - 1])) {
        // Last is number â†’ add it to history as final operand
        const lastNum = tempHistory.pop();
        tempHistory.push('+', lastNum); // fake '+' before last number for formatting
      }

      for (let i = 0; i < tempHistory.length; i += 2) {
        const num = tempHistory[i];
        const op = tempHistory[i + 1] || '';
        if (num) {
          summaryLines.push(op === '+' ? `+${num}` : op === '-' ? `-${num}` : op === 'Ã—' ? `Ã—${num}` : op === 'Ã·' ? `Ã·${num}` : num);
        }
      }

      // If only one number entered (no operators), just show that number
      if (summaryLines.length === 0 && calculationHistory.length === 1) {
        summaryLines = [calculationHistory[0]];
      }

      // Final line: = result
      totalLine = `=${formatNumber(Math.round(result))}`;

      // Store for WhatsApp
      window.invoiceSummary = {
        lines: summaryLines,
        total: totalLine,
        rawTotal: result
      };

      currentValue = String(result);
      previousValue = '';
      operator = null;
      waitingForSecondOperand = true;
      updateDisplay();

      // Show send modal
      setTimeout(() => {
        invoiceModal.style.display = 'flex';
        phoneNumberInput.focus();
      }, 300);
    }

    // Backspace
    function handleBackspace() {
      if (currentValue !== '0') {
        currentValue = currentValue.length === 1 ? '0' : currentValue.slice(0, -1);
        updateDisplay();
      }
    }

    // Send WhatsApp message
    function sendInvoice() {
      const number = phoneNumberInput.value.trim();
      if (!number || !/^\+?[0-9]{10,15}$/.test(number)) {
        alert('Please enter a valid phone number (10â€“15 digits, optional +)');
        return;
      }

      const { lines, total } = window.invoiceSummary;
      let msg = 'ðŸ›’ Invoice\n\n';
      lines.forEach(line => msg += `${line}\n`);
      msg += `\n${total}\n\nThank you!`;

      // Encode for WhatsApp URL
      const encodedMsg = encodeURIComponent(msg);
      const url = `https://web.whatsapp.com/send?phone=${number}&text=${encodedMsg}`;

      // Try web fallback first, then mobile deep link
      window.open(url, '_blank');

      // For mobile apps, also try deep link (Android/iOS)
      setTimeout(() => {
        const deepLink = `whatsapp://send?phone=${number}&text=${encodedMsg}`;
        window.location.href = deepLink;
      }, 500);

      // Close modal
      invoiceModal.style.display = 'none';
      clearAll();
    }

    // Event Listeners
    document.querySelectorAll('.btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const action = btn.dataset.action;
        const number = btn.dataset.number;

        if (action === 'clear') {
          clearAll();
        } else if (action === 'equals') {
          handleEquals();
        } else if (action === 'backspace') {
          handleBackspace();
        } else if (action === 'add' || action === 'subtract' || action === 'multiply' || action === 'divide') {
          handleOperator(action === 'add' ? '+' : action === 'subtract' ? '-' : action === 'multiply' ? 'Ã—' : 'Ã·');
        } else if (action === 'percent') {
          currentValue = String(parseFloat(currentValue) / 100);
          updateDisplay();
        } else if (action === 'parentheses') {
          // Optional: ignore or beep â€” not needed for shop use
        } else if (number) {
          if (number === '.') {
            inputDecimal();
          } else {
            inputNumber(parseFloat(number));
          }
        }
      });
    });

    sendBtn.addEventListener('click', sendInvoice);
    phoneNumberInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') sendInvoice();
    });

    // Initialize
    updateDisplay();
  </script>
</body>
</html>